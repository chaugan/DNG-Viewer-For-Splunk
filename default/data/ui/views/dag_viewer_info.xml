<dashboard version="1.0.0">
    <label>DAG Viewer - Documentation</label>
    <description>Learn how to use the DAG Viewer visualization for Splunk</description>
    
    <row>
        <panel>
            <html>
                <style>
                    .dag-docs { font-family: "Splunk Platform Sans", Arial, sans-serif; line-height: 1.6; }
                    .dag-docs h2 { color: #333; border-bottom: 2px solid #0072C6; padding-bottom: 8px; margin-top: 24px; }
                    .dag-docs h3 { color: #555; margin-top: 16px; }
                    .dag-docs code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
                    .dag-docs pre { background: #2B303A; color: #fff; padding: 16px; border-radius: 4px; overflow-x: auto; }
                    .dag-docs table { border-collapse: collapse; width: 100%; margin: 16px 0; }
                    .dag-docs th, .dag-docs td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                    .dag-docs th { background: #0072C6; color: white; }
                    .dag-docs tr:nth-child(even) { background: #f9f9f9; }
                    .dag-docs .tip { background: #e7f3ff; border-left: 4px solid #0072C6; padding: 12px; margin: 16px 0; }
                    .dag-docs .warning { background: #fff3e0; border-left: 4px solid #ff9800; padding: 12px; margin: 16px 0; }
                </style>
                <div class="dag-docs">
                    <h2>Overview</h2>
                    <p>
                        The <strong>DAG Viewer</strong> visualization renders Directed Acyclic Graphs (DAGs) using the GraphViz engine. 
                        It's perfect for visualizing workflows, attack trees, dependency graphs, process flows, and network topologies. It is based on this project: <a href="https://codesandbox.io/p/sandbox/dag-viewer-forked-wl185q" target="_blank">CodeSandbox DAG Viewer</a>
                    </p>
                    <p>
                        <strong>Key Features:</strong>
                    </p>
                    <ul>
                        <li>Two input modes: Raw DOT format or Structured data (source/target fields)</li>
                        <li>Interactive zoom and pan</li>
                        <li>Configurable layout direction (TB, LR, BT, RL)</li>
                        <li>Full node and edge styling support</li>
                        <li>Works in both Classic and Dashboard Studio</li>
                    </ul>
                    
                    <h2>Data Format Options</h2>
                    
                    <h3>Option 1: DOT Format (Recommended for Complex Graphs)</h3>
                    <p>Return a single field named <code>dot</code> containing the complete GraphViz DOT string:</p>
                    <pre>| makeresults count=1
| eval dot="digraph {
    rankdir=\"TB\";
    A [label=\"Start\"];
    B [label=\"End\"];
    A -> B;
}"</pre>
                    
                    <h3>Option 2: Structured Data (Easier for Dynamic Data)</h3>
                    <p>Return edge data with <code>source</code> and <code>target</code> fields:</p>
                    <pre>| makeresults 
| eval source="NodeA", target="NodeB"
| append [| makeresults | eval source="NodeB", target="NodeC"]
| fields source target</pre>
                    
                    <div class="tip">
                        <strong>Tip:</strong> DOT format gives you full control over styling and layout. 
                        Structured mode is easier when generating graphs from dynamic Splunk data.
                    </div>
                    
                    <h2>Field Reference</h2>
                    
                    <h3>Required Fields</h3>
                    <table>
                        <tr><th>Field</th><th>Mode</th><th>Description</th></tr>
                        <tr><td><code>dot</code></td><td>DOT</td><td>Complete GraphViz DOT format string</td></tr>
                        <tr><td><code>source</code></td><td>Structured</td><td>Source node ID for each edge</td></tr>
                        <tr><td><code>target</code></td><td>Structured</td><td>Target node ID for each edge</td></tr>
                    </table>
                    
                    <h3>Optional Styling Fields (Structured Mode)</h3>
                    <table>
                        <tr><th>Field</th><th>Description</th><th>Example</th></tr>
                        <tr><td><code>label</code></td><td>Edge label text</td><td>"Step 1"</td></tr>
                        <tr><td><code>source_color</code></td><td>Source node fill color</td><td>"#ED96AC"</td></tr>
                        <tr><td><code>source_fontcolor</code></td><td>Source node text color</td><td>"#ffffff"</td></tr>
                        <tr><td><code>source_style</code></td><td>Source node style</td><td>"filled, rounded"</td></tr>
                        <tr><td><code>target_color</code></td><td>Target node fill color</td><td>"#DB2955"</td></tr>
                        <tr><td><code>target_fontcolor</code></td><td>Target node text color</td><td>"#ffffff"</td></tr>
                        <tr><td><code>target_style</code></td><td>Target node style</td><td>"filled, rounded"</td></tr>
                        <tr><td><code>node_shape</code></td><td>Node shape (applies to both)</td><td>"box", "ellipse", "diamond"</td></tr>
                        <tr><td><code>edge_color</code></td><td>Edge line color</td><td>"#7692FF"</td></tr>
                        <tr><td><code>edge_style</code></td><td>Edge line style</td><td>"dashed", "dotted"</td></tr>
                    </table>
                    
                    <h2>Formatter Options</h2>
                    <p>Access the formatter menu by clicking "Format" when editing a dashboard panel:</p>
                    <table>
                        <tr><th>Option</th><th>Values</th><th>Default</th><th>Description</th></tr>
                        <tr><td>Layout Direction</td><td>TB, LR, BT, RL</td><td>TB</td><td>Graph flow direction (Top-Bottom, Left-Right, etc.)</td></tr>
                        <tr><td>Curved Edges</td><td>Yes/No</td><td>Yes</td><td>Use curved splines for edges</td></tr>
                        <tr><td>Prevent Overlap</td><td>Yes/No</td><td>Yes</td><td>Prevent nodes from overlapping</td></tr>
                        <tr><td>Node Separation</td><td>number</td><td>0.2</td><td>Horizontal spacing between nodes</td></tr>
                        <tr><td>Rank Separation</td><td>number</td><td>0.4</td><td>Vertical spacing between levels</td></tr>
                    </table>
                    
                    <div class="warning">
                        <strong>Note:</strong> Values set in the DOT string take precedence over formatter options. 
                        For example, if your DOT includes <code>rankdir="LR"</code>, it will override the formatter setting.
                    </div>
                    
                    <h2>Quick Start</h2>
                    <p>Try this SPL in a new search to see the visualization:</p>
                    <pre>| makeresults count=1
| eval dot="digraph {
    rankdir=\"TB\";
    node [shape=\"box\" style=\"filled\"];
    Start [fillcolor=\"#2B303A\" fontcolor=\"white\"];
    Process [fillcolor=\"#ED96AC\"];
    End [fillcolor=\"#DB2955\" fontcolor=\"white\"];
    Start -> Process -> End;
}"</pre>
                    <p>
                        Then select <strong>DAG Viewer</strong> from the visualization picker.
                    </p>
                    <p>
                        <strong>See more examples:</strong> Visit the <a href="dag_viewer_examples">DAG Viewer Examples</a> page for comprehensive examples.
                    </p>
                </div>
            </html>
        </panel>
    </row>
</dashboard>

